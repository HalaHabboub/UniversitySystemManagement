@model IEnumerable<UniversitySystemManagement.Models.Enrollment>

@{
    ViewData["Title"] = "My GPA";
    var student = ViewBag.Student as UniversitySystemManagement.Models.Student;
    decimal gpa = ViewBag.GPA;
    int totalCredits = ViewBag.TotalCredits;
    int completedCourses = ViewBag.CompletedCourses;
}

<h1>My GPA Report</h1>
<p class="text-muted">@student?.FullName()</p>
<hr />

<!-- GPA Summary -->
<div class="row mb-4">
    <div class="col-md-3">
        <div class="card text-white @(gpa >= 3.0m ? "bg-success" : gpa >= 2.0m ? "bg-warning" : "bg-danger")">
            <div class="card-body text-center">
                <h6>Cumulative GPA</h6>
                <p class="display-4">@gpa.ToString("F2")</p>
            </div>
        </div>
    </div>
    <div class="col-md-3">
        <div class="card bg-light">
            <div class="card-body text-center">
                <h6>Total Credits Earned</h6>
                <p class="display-6">@totalCredits</p>
            </div>
        </div>
    </div>
    <div class="col-md-3">
        <div class="card bg-light">
            <div class="card-body text-center">
                <h6>Courses Completed</h6>
                <p class="display-6">@completedCourses</p>
            </div>
        </div>
    </div>
</div>

<!-- GPA Scale Reference -->
<div class="card mb-4" style="max-width: 500px;">
    <div class="card-header">GPA Scale</div>
    <div class="card-body">
        <small>
            A (90-100) = 4.0 | A- (85-89) = 3.7 | B+ (80-84) = 3.3<br/>
            B (75-79) = 3.0 | B- (70-74) = 2.7 | C+ (65-69) = 2.3<br/>
            C (60-64) = 2.0 | C- (55-59) = 1.7 | D (50-54) = 1.0 | F (&lt;50) = 0.0
        </small>
    </div>
</div>

<!-- Graded Courses -->
<h4>Graded Courses</h4>
<table class="table table-striped">
    <thead>
        <tr>
            <th>Course</th>
            <th>Credits</th>
            <th>Mark</th>
            <th>Grade</th>
            <th>Grade Points</th>
        </tr>
    </thead>
    <tbody>
        @foreach (var enrollment in Model)
        {
            var gradePoint = enrollment.Mark!.Value switch
            {
                >= 90 => 4.0m,
                >= 85 => 3.7m,
                >= 80 => 3.3m,
                >= 75 => 3.0m,
                >= 70 => 2.7m,
                >= 65 => 2.3m,
                >= 60 => 2.0m,
                >= 55 => 1.7m,
                >= 50 => 1.0m,
                _ => 0.0m
            };
            var grade = enrollment.Mark.Value switch
            {
                >= 90 => "A",
                >= 85 => "A-",
                >= 80 => "B+",
                >= 75 => "B",
                >= 70 => "B-",
                >= 65 => "C+",
                >= 60 => "C",
                >= 55 => "C-",
                >= 50 => "D",
                _ => "F"
            };
            <tr>
                <td>@enrollment.Course?.Title</td>
                <td>@enrollment.Course?.Credits</td>
                <td>@enrollment.Mark.Value.ToString("F1")</td>
                <td><span class="badge @(enrollment.Mark >= 60 ? "bg-success" : "bg-danger")">@grade</span></td>
                <td>@gradePoint.ToString("F1")</td>
            </tr>
        }
    </tbody>
</table>

@if (!Model.Any())
{
    <div class="alert alert-info">No graded courses yet.</div>
}

<a asp-action="MyCourses" class="btn btn-secondary">Back to My Courses</a>
